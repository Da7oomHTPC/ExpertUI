<!-- Home view -->

<script>
    function refreshPage(){
        window.location.reload();
    }
</script>

<div ng-controller="HomeController">
    <div class="form-inline form-home-ip" ng-show="cfg.custom_ip">

        <div class="form-home-ip-in product-data-list">
            <input name="custom_ip" id="custom_ip" type="text" class="form-control" ng-model="customIP.url" value="{{customIP.url}}" placeholder="Server Name or IP, e.g. 192.168.1.1" />
            <button type="button" class="btn btn-primary" id="btn_add_ip" ng-click="setIP(customIP.url)">Connect</button>
            <div class="text-danger custom-ip-message custom-ip-error">Error in connecting {{cfg.server_url}}</div>
            <div class="text-success custom-ip-message custom-ip-success">Connected to {{cfg.server_url}}</div>
        </div>
    </div>
    <div class="row home-page_" ng-show="ZWaveAPIData">
        <div class="col-sm-6 home-page-image">
            <img class="product-logo" ng-src="{{getCustomCfgArr('logo')}}" alt="Logo" />
            <p></p>

            <div class="product-description" ng-bind-html="_t('txt_homepage_promo_' + cfg.app_type) | toTrusted"></div>


            <div>
                <form name="form_rename" id="form_notes" ng-model="form_notes" class="form" ng-submit="saveNotes('form_notes', '#btn_save_note')" novalidate>
                    <h3>{{_t('network_name')}}</h3>
                    <p><input type="text" name="networkname" class="form-control"></p>
                    <h3>{{_t('txt_notes')}}</h3>
                    <p><textarea id="note" name="note" class="form-control" rows="20">{{notesData}}</textarea><br /></p>
                    <button type="submit" class="btn btn-primary"  id="btn_save_note">{{_t('btn_save')}}</button>
                </form>
            </div>
        </div>
        <div class="col-sm-6 product-data-list pull-right_">
            <!-- Z-Wave Network -->
            <div ng-controller="HomeDongleController">
                <div class="form-inline home-dongle" ng-if="homeDongle.data.length > 0">
                    <h3><i class="fa fa-code-fork"></i> {{_t('select_dongle')}}</h3>
                    <select class="form-control" ng-model="homeDongle.model.dongle" ng-change="setHomeDongle()" >
                        <option value="" class="hidden-selectopt">--- Select one ---</option>
                        <option ng-repeat="v in homeDongle.data" ng-selected="homeDongle.model.current == v" value="{{v}}">{{v}}</option>
                    </select>

                </div>
                <h3 ng-if="homeDongle.data.length < 1"><i class="fa fa-code-fork"></i> {{_t('zwave_network')}}: <em>{{cfg.dongle}}</em></h3>
            </div>
            <!-- Network Information -->
            <h3><i class="fa fa-info-circle"></i> {{_t('txt_network_info')}}</h3>
            <p><strong>{{countDevices}}</strong> {{_t('txt_devices_present')}}:</p>
            <ul class="list-group">
                <li class="list-group-item"><strong>{{mainsDevices}}</strong> {{_t('txt_devices_mains')}}</li>
                <li class="list-group-item"><strong>{{batteryWakeupDevices}}</strong> {{_t('txt_devices_battery')}}</li>
                <li class="list-group-item"><strong>{{flirsDevices}}</strong> {{_t('txt_devices_flirs')}}</li>
            </ul>

            <!-- only default -->
            <div ng-if="cfg.app_type === 'default'">
                <!-- Network Health -->
                <h3><i class="fa fa-plus-square"></i> {{_t('txt_net_health')}}</h3>
                <ul class="list-group">
                    <li class="list-group-item">
                        <p ng-repeat="v in lowBatteryDevices">
                            <a class="text-danger" href="#device/battery">(#{{v.id}}) {{v.name}} {{_t('txt_low_battery')}} ({{v.battery_charge}}%)</a>
                        </p>
                    </li>
                    <li class="list-group-item" ng-if="cfg.app_type === 'default'">
                        <p ng-repeat="v in notInterviewDevices">
                            <a class="text-danger" href="#help/{{v.id}}"> (#{{v.id}}) {{v.name}} {{_t('txt_interview_not')}}</a>
                        </p>
                    </li>
                    <li class="list-group-item" ng-show="assocRemovedDevices.length > 1">
                        <p ng-repeat="v in assocRemovedDevices">
                            <a class="text-danger" href="#configuration/interview/{{v.id}}">(#{{v.id}}) {{v.name}} {{_t('txt_assoc_removed')}}:</a><br />
                            <em ng-repeat="a in v.assoc">{{a.name}}, </em>
                        </p>
                    </li>
                    <li class="list-group-item">
                        <p ng-repeat="v in failedDevices">
                            <a class="text-danger" href="#help/{{v.id}}">(#{{v.id}}) {{v.name}} {{_t('txt_failed')}}</a>
                        </p>
                    </li>
                    <li class="list-group-item">
                        <p ng-repeat="v in notConfigDevices| unique:id">
                            <a class="text-danger" href="#configuration/interview/{{v.id}}">(#{{v.id}}) {{v.name}} {{_t('device_changed_configuration')}}</a>
                        </p>
                    </li>
                </ul>
                <!-- Device reset locally -->
                <h3><i class="fa fa-info-circle"></i> {{_t('device_reset_locally')}}</h3>
                <ul class="list-group">
                    <li class="list-group-item" ng-repeat="v in localyResetDevices"> (#{{v.id}}) {{v.name}}</li>
                    <li class="list-group-item" ng-show="localyResetDevices.length < 1">{{_t('no_device_reset_locally')}}</li>
                </ul>
            </div>

            <!-- only installer -->
            <div class="cfg-block form-inline" ng-if="cfg.app_type === 'installer'">
                <!-- Not included in network -->
                <div ng-if="boxData.controller.isPrimary && (!boxData.controller.hasDevices && boxData.controller.controllerState == 0)">
                    <p class="input-help">{{_t('device_not_included_info')}}</p>
                    <button
                            class="btn btn-primary"
                            id="btn_learn_start"
                            ng-click="runZwaveCmd('controller.SetLearnMode(1)')"
                            onClick="refreshPage()"

                    >{{_t('include_into_network')}}</button>
                </div>

                <!-- included in network -->
                <div  ng-if="boxData.controller.isPrimary && (boxData.controller.hasDevices)">
                    <p class="input-help">{{_t('device_included_info')}}</p>
                    <button
                            class="btn btn-primary"
                            id="btn_learn_start"
                            ng-click="runZwaveCmd('controller.SetLearnMode(1)')"
                            style="background-color: grey;"
                            disabled
                    >{{_t('leave_network')}}</button>
                </div>

                <!-- included in network -->
                <div ng-if="!boxData.controller.isPrimary">
                    <p class="input-help">{{_t('device_included_info')}}</p>
                    <button
                            class="btn btn-danger"
                            id="btn_learn_stop"
                            ng-click="runZwaveCmd('controller._SetLearnMode(0)',_t('before_leaving_network'))"

                    > {{_t('leave_network')}}</button>
                </div>


                <!-- stop inclusion -->
                <button
                        class="btn btn-danger"
                        id="btn_learn_stop"
                        ng-click="runZwaveCmd('controller.SetLearnMode(0)')"
                        ng-if="boxData.controller.controllerState == 9 && boxData.controller.isPrimary"
                        onClick="refreshPage()"
                > {{_t('Stop inclusion')}}</button>





            </div>
            <h3><i class="fa fa-download"></i> {{_t('nm_backup_title')}}</h3>
            <div class="panel panel-default">
                <div class="panel-body">
                    <!-- backup -->
                    <a class="btn btn-primary" href="{{cfg.server_url}}/ZWaveAPI/Backup">{{_t('nm_backup_download')}}</a>
                    <button
                            class="btn btn-primary"
                            data-ng-click="showModal('#modal_restore_backup')"
                    >{{_t('nm_restore_backup_upload')}}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal restore backup -->
    <div class="modal fade" id="modal_restore_backup" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">{{_t('nm_restore_backup_upload')}}</h4>
                </div>
                <div class="modal-body">
                    <div class="restore-backup-control" ng-show_="restoreBackupStatus == 0">
                        <div class="alert alert-warning">
                            <input type="checkbox" name="restore_confirm" value="1" id="restore_confirm" ng-click="goRestore = !goRestore" /> <span ng-bind-html="_t('are_you_sure_restore') | toTrusted"></span>
                        </div>
                        <div ng-show="goRestore">
                            <input
                                    type="checkbox"
                                    name="restore_chip_info"
                                    id="restore_chip_info"
                                    value="1"
                                    ng-true-value="1"
                                    ng-false-value="0"
                                    ng-model="modelRestoreChipInfo" /> {{_t('restore_backup_chip')}}

                        </div>
                        <p class="text-center">
                            <!--<button
                       ng-show="goRestore"
                       ng-file-select="restoreBackup($files,modelRestoreChipInfo,'.btn-spinner-hidden','#btn_upload')"
                       data-multiple="true"
                       onclick="this.value = null"
                       id="btn_upload"
                       class="btn btn-primary"
                       ><i class="fa fa-download"></i> {{_t('nm_restore_pick_up')}}<input type="file" ng-file-select="restoreBackup($files,modelRestoreChipInfo,'.btn-spinner-hidden','#btn_upload')" data-multiple="true" title="select file" onclick="this.value = null" class="upload-button" multiple="multiple" style="top: 0px; bottom: 0px; left: 0px; right: 0px; width: 100%; opacity: 0; position: absolute;"></button>-->

                            <input id="btn_upload" ng-show="goRestore" type="file" name="file" onchange="angular.element(this).scope().restoreFromFile(this.files,'.btn-spinner-hidden','#btn_upload')" />
                        </p>

                    </div>
                    <div class="alert alert-info" ng-show="restoreBackupStatus == 1"> {{_t('restore_wait')}}</div>
                    <div class="alert alert-success" ng-show="restoreBackupStatus == 2">{{_t('restore_done_reload_ui')}}</div>
                    <div class="alert alert-danger" ng-show="restoreBackupStatus == 3">{{_t('restore_backup_failed')}}</div>
                </div>
                <div class="modal-footer">

                    <button type="button" class="btn btn-default" ng-click="closeBackup('#modal_restore_backup')" data-dismiss="modal">{{_t('btn_cancel')}}</button>
                </div>
            </div>
        </div>
    </div><!-- /.Modal -->

</div>
