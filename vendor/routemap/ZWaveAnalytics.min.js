window.ZWaveNetworkAnalyticsLib=function(){function q(b,a){return b.length===a.length&&b.every(function(b,d){return b===a[d]})}function k(b){return b.reduce(function(a,b){return a+b},0)}function l(b){return b?k(b)/b.length:void 0}function r(b){return b.filter(function(a,b,d){return d.indexOf(a)===b})}function m(b){b.sort(function(a,b){return a-b})}function h(b,a){this.src=b;this.h=a;this.g=[];this.C=this.o=0}function f(){this.links=[]}function n(b,a){this.src=b;this.h=a;this.f=[]}function p(b){this.m=
0;this.path=b.slice()}function g(){this.l=[]}function e(b,a,c){this.a=b;this.I=a;this.P=c||[];this.i=this.a.controller.data.nodeId.value;this.w=[];this.links=[];this.b=new f;this.j=new g;this.D=[];this.U();this.S();this.T();this.R()}h.prototype.use=function(b,a,c,d){this.o+=d?d:1;c=127===c||void 0===c||10<c||-128>c?null:125===c?-128:126===c?10:c;null!==c&&this.g.push(c)};h.prototype.s=function(){this.C++};h.prototype.usage=function(){return this.o};h.prototype.A=function(){return this.g};f.prototype.use=
function(b,a,c,d){this.c(b,a).use(b,a,c,d)};f.prototype.s=function(b,a){this.c(b,a).s()};f.prototype.H=function(b,a,c,d,t){var e=c.slice();e.unshift(b);b=c.slice();b.push(a);a=d?d.slice():void 0;for(c=0;c<e.length;c++)this.use(e[c],b[c],d?a[c]:void 0,t)};f.prototype.c=function(b,a){var c=this.links.filter(function(c){return c.src==b&&c.h==a})[0];c||(c=new h(b,a),this.links.push(c));return c};f.prototype.usage=function(b,a){var c=Math.max(0,Math.max.apply(null,this.links.map(function(a){return a.usage()}))),
d=this.c(b,a).usage();return 0!==c?d/c:0};f.prototype.F=function(b,a){var c=this.c(b,a),d=c.usage();return 0!==d?c.C/d:0};f.prototype.A=function(b,a){var c;(c=l(this.c(b,a).g))||(c=l(this.c(b,a).g));return c?(c-0)/-100:0};n.prototype.B=function(b){var a=this.f.filter(function(a){return q(a.path,b)})[0];a||(a=new p(b),this.f.push(a));a.use()};p.prototype.use=function(){this.m++};g.prototype.G=function(b,a){var c=this.l.filter(function(c){return c.src==b&&c.h==a})[0];c||(c=new n(b,a),this.l.push(c));
return c};g.prototype.B=function(b,a,c){this.G(b,a).B(c)};g.prototype.O=function(b,a){return this.G(b,a).f};g.prototype.v=function(b,a){var c=this.O(b,a),d=new f;c.forEach(function(c){d.H(b,a,c.path,void 0,c.m)});return d};g.prototype.M=function(b){var a=0,c=0;this.l.forEach(function(d){a+=k(d.f.map(function(a){return-1===a.path.indexOf(b)?0:a.m}));c+=k(d.f.map(function(a){return a.m}))});return c?a/c:0};g.prototype.u=function(b){var a=[];this.l.forEach(function(c){0<k(c.f.map(function(a){return-1===
a.path.indexOf(b)?0:1}))&&a.push(c.h)});m(a);return a};e.prototype.U=function(){var b=this;this.I.forEach(function(a){a.hops&&(b.j.B(b.i,a.nodeId.value,a.hops.value),b.b.H(b.i,a.nodeId.value,a.hops.value,a.returnRSSI.value,1),0!=a.lastFailPath.value[0]&&b.b.s(a.lastFailPath.value[0],a.lastFailPath.value[1]))})};e.prototype.S=function(){var b=this,a;for(a in this.a.devices)if(a=parseInt(a,10),1!=this.a.devices[a].data.basicType.value){var c;c=a===this.i?"Controller":!1===this.a.devices[a].data.isListening.value?
!0===this.a.devices[a].data.sensor250.value||!0===this.a.devices[a].data.sensor1000.value?"FLiRS":"Sleeping":"Routing";this.w.push({id:a,usage:this.j.M(a),type:c,x:null,y:null,name:this.a.devices[a].data.givenName.value,dead:this.a.devices[a].data.isFailed.value});c=this.a.devices[a].data.neighbours.value.slice();for(var d in this.a.devices)d=parseInt(d,10),-1===c.indexOf(d)&&(this.a.devices[d]&&-1!==this.a.devices[d].data.neighbours.value.indexOf(a)?(console.log("Adding asymmetrical route "+a+" -> "+
d+" to official neighbour list"),c.push(d)):this.a.devices[d]&&1!==this.a.devices[d].data.basicType.value&&(0<this.b.usage(a,d)||0<this.b.usage(d,a))&&this.a.devices[d]&&(console.log("Adding actual route "+a+" -> "+d+" to official neighbour list"),c.push(d)));c.forEach(function(c){if(a!=c){var d=b.links.filter(function(b){return b.source==c&&b.target==a})[0];d?Object.assign(d,{rssi21:b.b.A(a,c),usage21:b.b.usage(a,c),fails21:b.b.F(a,c)}):b.links.push({source:a,target:c,rssi12:b.b.A(a,c),usage12:b.b.usage(a,
c),fails12:b.b.F(a,c)})}})}};e.prototype.T=function(){var b=this;this.w.map(function(a){var c=b.P.filter(function(b){return b.id===a.id})[0];c&&(a.x=c.x,a.y=c.y)})};e.prototype.R=function(){var b,a;for(a in this.a.devices){a=parseInt(a,10);b=[];var c=this.a.devices[a].instances,d;for(d in c){if(c[d].commandClasses[133])for(var e in c[d].commandClasses[133].data)e=parseInt(e,10),!isNaN(e)&&c[d].commandClasses[133].data[e].nodes.value&&c[d].commandClasses[133].data[e].nodes.value.forEach(function(a){b.push(a)});
if(c[d].commandClasses[142])for(e in c[d].commandClasses[142].data)if(e=parseInt(e,10),!isNaN(e)&&c[d].commandClasses[142].data[e].nodesInstances.value){var f=0;c[d].commandClasses[142].data[e].nodesInstances.value.forEach(function(a){0===f++%2&&b.push(a)})}}m(b);this.D[a]=r(b)}};e.prototype.L=function(b){return this.D[b]};e.prototype.N=function(){return this.w};e.prototype.J=function(){return this.links};e.prototype.K=function(){return this.i};e.prototype.u=function(b){return this.j.u(b)};e.prototype.v=
function(b,a){return this.j.v(b,a)};return e}();window.ZWaveNetworkAnalyticsLib.prototype.getNodes=ZWaveNetworkAnalyticsLib.prototype.N;window.ZWaveNetworkAnalyticsLib.prototype.getLinks=ZWaveNetworkAnalyticsLib.prototype.J;window.ZWaveNetworkAnalyticsLib.prototype.getMyNodeId=ZWaveNetworkAnalyticsLib.prototype.K;window.ZWaveNetworkAnalyticsLib.prototype.getNodeAssociations=ZWaveNetworkAnalyticsLib.prototype.L;window.ZWaveNetworkAnalyticsLib.prototype.getNodesRoutedFor=ZWaveNetworkAnalyticsLib.prototype.u;
window.ZWaveNetworkAnalyticsLib.prototype.getTrajectoryLinkMap=ZWaveNetworkAnalyticsLib.prototype.v;
