window.ZWaveNetworkAnalyticsLib=function(){function t(b,a){return b.length===a.length&&b.every(function(b,d){return b===a[d]})}function l(b){return b.reduce(function(a,b){return a+b},0)}function p(b){return b?l(b)/b.length:void 0}function u(b){return b.filter(function(a,b,d){return d.indexOf(a)===b})}function q(b){b.sort(function(a,b){return a-b})}function k(b,a){this.src=b;this.m=a;this.l=[];this.K=this.w=0}function g(){this.links=[]}function m(b,a){this.src=b;this.m=a;this.c=[];this.A=this.i=this.s=
this.j=0}function r(b){this.v=0;this.path=b.slice()}function h(){this.u=[]}function f(b,a,c){this.a=b;this.O=a;this.X=c||[];this.h=this.a.controller.data.nodeId.value;this.G=[];this.links=[];this.b=new g;this.g=new h;this.L=[];this.aa();this.Z();this.$();this.Y()}k.prototype.use=function(b,a,c,d){this.w+=d?d:1;c=127===c||void 0===c||-32<c&&125>c||-94>c?null:125===c?-94:126===c?-32:c;null!==c&&this.l.push(c)};k.prototype.B=function(){this.K++};k.prototype.usage=function(){return this.w};k.prototype.I=
function(){return this.l};g.prototype.use=function(b,a,c,d){this.f(b,a).use(b,a,c,d)};g.prototype.B=function(b,a){this.f(b,a).B()};g.prototype.P=function(b,a,c,d,e){var n=c.slice();n.unshift(b);b=c.slice();b.push(a);a=d?d.slice():void 0;for(c=0;c<n.length;c++)this.use(n[c],b[c],d?a[c]:void 0,e)};g.prototype.f=function(b,a){var c=this.links.filter(function(c){return c.src==b&&c.m==a})[0];c||(c=new k(b,a),this.links.push(c));return c};g.prototype.usage=function(b,a){var c=Math.max(0,Math.max.apply(null,
this.links.map(function(a){return a.usage()}))),d=this.f(b,a).usage();return 0!==c?d/c:0};g.prototype.M=function(b,a){var c=this.f(b,a),d=c.usage();return 0!==d?c.K/d:0};g.prototype.I=function(b,a){var c;(c=p(this.f(b,a).l))||(c=p(this.f(b,a).l));return c?(c-0)/-100:0};m.prototype.J=function(b,a){var c=this.c.filter(function(a){return t(a.path,b)})[0];c||(c=new r(b),this.c.push(c));c.use();this.j++;this.s+=a};m.prototype.H=function(b){this.i++;this.A+=b?1:0};m.prototype.getStats=function(){var b=
this.c.map(function(a){return a.path.length});return{da:Math.min.apply(null,b),ca:Math.max.apply(null,b),s:this.j?this.s/this.j:null,ba:this.i?this.A/this.i:null,j:this.j,i:this.i}};r.prototype.use=function(){this.v++};h.prototype.o=function(b,a){var c=this.u.filter(function(c){return c.src==b&&c.m==a})[0];c||(c=new m(b,a),this.u.push(c));return c};h.prototype.J=function(b,a,c,d){this.o(b,a).J(c,d)};h.prototype.H=function(b,a,c){this.o(b,a).H(c)};h.prototype.W=function(b,a){return this.o(b,a).c};
h.prototype.F=function(b,a){return this.o(b,a).getStats()};h.prototype.D=function(b,a){var c=this.W(b,a),d=new g;c.forEach(function(c){d.P(b,a,c.path,void 0,c.v)});return d};h.prototype.U=function(b){var a=0,c=0;this.u.forEach(function(d){a+=l(d.c.map(function(a){return-1===a.path.indexOf(b)?0:a.v}));c+=l(d.c.map(function(a){return a.v}))});return c?a/c:0};h.prototype.C=function(b){var a=[];this.u.forEach(function(c){0<l(c.c.map(function(a){return-1===a.path.indexOf(b)?0:1}))&&a.push(c.m)});q(a);
return a};f.prototype.aa=function(){var b=this;this.O.forEach(function(a){a.frameType&&b.g.H(a.nodeId,b.h,"Explore Frame"===a.frameType)});this.N=!1;this.O.forEach(function(a){a.delivered&&a.hops&&(b.N=!0,b.g.J(b.h,a.nodeId,a.hops,a.tries-1),b.b.P(b.h,a.nodeId,a.hops,a.returnRSSI,1),0!=a.lastFailPath[0]&&b.b.B(a.lastFailPath[0],a.lastFailPath[1]))})};f.prototype.Z=function(){var b=this;for(a in this.a.devices){var a=parseInt(a,10);if(1!=this.a.devices[a].data.basicType.value){var c=a===this.h?"Controller":
!1===this.a.devices[a].data.isListening.value?!0===this.a.devices[a].data.sensor250.value||!0===this.a.devices[a].data.sensor1000.value?"FLiRS":"Sleeping":"Routing";this.G.push({id:a,usage:this.g.U(a),type:c,x:null,y:null,name:this.a.devices[a].data.givenName.value,dead:this.a.devices[a].data.isFailed.value});c=this.a.devices[a].data.neighbours.value.slice();var d=c.filter(function(a){return!!b.a.devices[a]});d.length!==c.length&&(console.log("Fixed neighbours for node "+a+" from "+c+" to "+d),c=
d);for(var e in this.a.devices)e=parseInt(e,10),-1===c.indexOf(e)&&(this.a.devices[e]&&-1!==this.a.devices[e].data.neighbours.value.indexOf(a)?(console.log("Adding asymmetrical route "+a+" -> "+e+" to official neighbour list"),c.push(e)):this.a.devices[e]&&1!==this.a.devices[e].data.basicType.value&&(0<this.b.usage(a,e)||0<this.b.usage(e,a))&&this.a.devices[e]&&(console.log("Adding actual route "+a+" -> "+e+" to official neighbour list"),c.push(e)));c.forEach(function(c){if(a!=c){var d=b.links.filter(function(b){return b.source==
c&&b.target==a})[0];d?Object.assign(d,{rssi21:b.b.I(a,c),usage21:b.b.usage(a,c),fails21:b.b.M(a,c)}):b.links.push({source:a,target:c,rssi12:b.b.I(a,c),usage12:b.b.usage(a,c),fails12:b.b.M(a,c)})}})}}};f.prototype.$=function(){var b=this;this.G.map(function(a){var c=b.X.filter(function(b){return b.id===a.id})[0];c&&(a.x=c.x,a.y=c.y)})};f.prototype.Y=function(){for(b in this.a.devices){var b=parseInt(b,10);var a=[];var c=this.a.devices[b].instances,d;for(d in c){if(c[d].commandClasses[133])for(var e in c[d].commandClasses[133].data)e=
parseInt(e,10),!isNaN(e)&&c[d].commandClasses[133].data[e].nodes.value&&c[d].commandClasses[133].data[e].nodes.value.forEach(function(b){a.push(b)});if(c[d].commandClasses[142])for(e in c[d].commandClasses[142].data)if(e=parseInt(e,10),!isNaN(e)&&c[d].commandClasses[142].data[e].nodesInstances.value){var f=0;c[d].commandClasses[142].data[e].nodesInstances.value.forEach(function(b){0===f++%2&&a.push(b)})}}q(a);this.L[b]=u(a)}};f.prototype.T=function(b){return this.L[b]};f.prototype.V=function(){return this.G};
f.prototype.R=function(){return this.links};f.prototype.S=function(){return this.h};f.prototype.C=function(b){return this.g.C(b)};f.prototype.D=function(b,a){return this.g.D(b,a)};f.prototype.F=function(b,a){return this.g.F(b,a)};f.prototype.getStats=function(){return{haveIMA:this.N}};return f}();window.ZWaveNetworkAnalyticsLib.prototype.getNodes=window.ZWaveNetworkAnalyticsLib.prototype.V;window.ZWaveNetworkAnalyticsLib.prototype.getLinks=window.ZWaveNetworkAnalyticsLib.prototype.R;
window.ZWaveNetworkAnalyticsLib.prototype.getMyNodeId=window.ZWaveNetworkAnalyticsLib.prototype.S;window.ZWaveNetworkAnalyticsLib.prototype.getNodeAssociations=window.ZWaveNetworkAnalyticsLib.prototype.T;window.ZWaveNetworkAnalyticsLib.prototype.getNodesRoutedFor=window.ZWaveNetworkAnalyticsLib.prototype.C;window.ZWaveNetworkAnalyticsLib.prototype.getTrajectoryLinkMap=window.ZWaveNetworkAnalyticsLib.prototype.D;window.ZWaveNetworkAnalyticsLib.prototype.getTrajectoryStats=window.ZWaveNetworkAnalyticsLib.prototype.F;
window.ZWaveNetworkAnalyticsLib.prototype.getStats=window.ZWaveNetworkAnalyticsLib.prototype.getStats;