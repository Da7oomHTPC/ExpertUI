
<script type="text/javascript">
    var request = function loadJSON(callback) {

        var xobj = new XMLHttpRequest();
        xobj.overrideMimeType("application/json");
        xobj.open('GET', '../ZWaveAPI/RSSIGet', true);
        xobj.onreadystatechange = function () {
            if (xobj.readyState == 4 && xobj.status == "200") {
                callback(xobj.responseText);
            }
        };
        xobj.send(null);
    };

    window.onload = function () {
        var dataPoints1 = [], dataPoints2 = [];
        var chart1, chart2;

        request(function(response) {
            var json = JSON.parse(response);
            var array = json.data;
            array.forEach(function (entry){
                if (new Date(entry.time * 1000) > (new Date().setHours(0,0,0,0))) {
                    dataPoints1.push({x: new Date(entry.time * 1000), y: parseInt(entry.channel1)});
                    dataPoints2.push({x: new Date(entry.time * 1000), y: parseInt(entry.channel2)});
                }
            });

            chart1 = new CanvasJS.Chart("chart1",
                    {
                        title:{
                            text: "Channel 1"
                        },
                        axisX:{
                            title: "Time",
                            tickColor: "black",
                            tickLength: 5,
                            tickThickness: 2,
                            valueFormatString: "HH:mm"
                        },
                        axisY:{
                            title: "RSSI (dBm)",
                            tickColor: "black",
                            tickLength: 5,
                            tickThickness: 2
                        },
                        data: [
                            {
                                type: "line",
                                xValueType: "dateTime",
                                xValueFormatString: "HH:mm",
                                dataPoints: dataPoints1
                            }
                        ],
                        zoomEnabled:true
                    });

            chart2 = new CanvasJS.Chart("chart2",
                    {
                        title:{
                            text: "Channel 2"
                        },
                        axisX:{
                            title: "Time",
                            tickColor: "black",
                            tickLength: 5,
                            tickThickness: 2,
                            valueFormatString: "HH:mm"
                        },
                        axisY:{
                            title: "RSSI (dBm)",
                            tickColor: "black",
                            tickLength: 5,
                            tickThickness: 2
                        },
                        data: [
                            {
                                type: "line",
                                xValueType: "dateTime",
                                xValueFormatString: "HH:mm",
                                dataPoints: dataPoints2
                            }
                        ],
                        zoomEnabled:true
                    });

            chart1.render();
            chart2.render();
            updateChart();
        });

        function updateChart(){
            dataPoints1 = [], dataPoints2 = [];

            request(function(response) {
                var json = JSON.parse(response);
                var array = json.data;
                array.forEach(function (entry){
                    if (new Date(entry.time * 1000) > (new Date().setHours(0,0,0,0))) {
                        dataPoints1.push({x: new Date(entry.time * 1000), y: parseInt(entry.channel1)});
                        dataPoints2.push({x: new Date(entry.time * 1000), y: parseInt(entry.channel2)});
                    }
                });

                chart1.render();
                chart2.render();

                setTimeout(function(){updateChart()}, 60000);
            });
        };
    }
</script>

<div id="chart1" style="height: 400px; width: 100%;">
</div>
<div id="chart2" style="height: 400px; width: 100%;">
</div>
